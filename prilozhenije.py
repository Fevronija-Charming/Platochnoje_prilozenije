import asyncio
from colorama import *
from fastapi import FastAPI
from fastapi import HTTPException
from fastapi import Depends
from typing import Annotated
import uvicorn
#заяц погашен
#from faststream.rabbit.fastapi import RabbitBroker, RabbitRouter
#router=RabbitRouter(host="localhost", port=5672)
app = FastAPI()
from pydantic import BaseModel, Field, ValidationError
from dotenv import find_dotenv, load_dotenv
import os
from tokenize import String
load_dotenv(find_dotenv())
#работа с базой данных
from sqlalchemy import  DateTime, String, Float, Column, Integer, func,Text
from sqlalchemy import  select
from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine, async_sessionmaker
from psycopg2.errors import *
engine = create_async_engine(os.getenv("DBURL"),echo=True,max_overflow=5,pool_size=5)
session_factory = async_sessionmaker(bind=engine,class_=AsyncSession,expire_on_commit=False)
class Base(DeclarativeBase):
    pass
class Platoky(Base):
    __tablename__="ПППЛАТКИ"
    id: Mapped[int]=mapped_column(primary_key=True, autoincrement=True, nullable=False)
    Название: Mapped[str]=mapped_column(String(128), nullable=False)
    Автор: Mapped[str]=mapped_column(String(128), nullable=False)
    Колорит_1: Mapped[str]=mapped_column(String(128), nullable=False)
    Колорит_2: Mapped[str] = mapped_column(String(128), nullable=False)
    Колорит_3: Mapped[str] = mapped_column(String(128), nullable=False)
    Колорит_4: Mapped[str] = mapped_column(String(128), nullable=False)
    Колорит_5: Mapped[str] = mapped_column(String(128), nullable=False)
    Узор_темени: Mapped[str] = mapped_column(String(128), nullable=False)
    Узор_сердцевины: Mapped[str] = mapped_column(String(128), nullable=False)
    Узор_сторон: Mapped[str] = mapped_column(String(128), nullable=False)
    Узор_углов: Mapped[str] = mapped_column(String(128), nullable=False)
    Узор_края: Mapped[str] = mapped_column(String(128), nullable=False)
    Цветы_Орнамент: Mapped[str] = mapped_column(String(128), nullable=False)
    Изображенный_Цветок_1: Mapped[str] = mapped_column(String(128), nullable=False)
    Изображенный_Цветок_2: Mapped[str] = mapped_column(String(128), nullable=False)
    Изображенный_Цветок_3: Mapped[str] = mapped_column(String(128), nullable=False)
    Изображенный_Цветок_4: Mapped[str] = mapped_column(String(128), nullable=False)
    Изображенный_Цветок_5: Mapped[str] = mapped_column(String(128), nullable=False)
    Размер_Платка: Mapped[str]=mapped_column(String(128), nullable=False)
    Материал_Платка: Mapped[str]=mapped_column(String(128), nullable=False)
    Материал_Бахромы: Mapped[str]=mapped_column(String(128), nullable=False)
    # для проверки '''INSERT INTO ПППЛАТКИ (id, Название, Автор, Колорит_1, Колорит_2, Колорит_3,
    # Колорит_4, Колорит_5, Узор_темени, Узор_сердцевины, Узор_сторон, Узор_углов, Узор_края,
    # Цветы_Орнамент, Изображенный_Цветок_1, Изображенный_Цветок_2, Изображенный_Цветок_3,
    # Изображенный_Цветок_4, Изображенный_Цветок_5, Размер_Платка, Материал_Платка, Материал_Бахромы)'
class Symboly(Base):
    __tablename__="Значение_Символов_Орнамента"
    id: Mapped[int]=mapped_column(primary_key=True, autoincrement=True, nullable=False)
    Название_Символа: Mapped[str]=mapped_column(String(32), nullable=False)
    Значение_Символа: Mapped[str]=mapped_column(Text, nullable=False)
    Встречается_На_Платках: Mapped[str]=mapped_column(Text, nullable=False)
    Ассоциативная_Иллюстрация_1: Mapped[str] = mapped_column(String(128), nullable=False)
    Ассоциативная_Иллюстрация_2: Mapped[str] = mapped_column(String(128), nullable=False)
    Символ_На_Платке_1: Mapped[str] = mapped_column(String(128), nullable=False)
    Символ_На_Платке_2: Mapped[str] = mapped_column(String(128), nullable=False)
    Символ_На_Платке_3: Mapped[str] = mapped_column(String(128), nullable=False)
    Символ_На_Платке_4: Mapped[str] = mapped_column(String(128), nullable=False)
    Символ_На_Платке_5: Mapped[str] = mapped_column(String(128), nullable=False)
class Banda(Base):
    __tablename__="Платочная_Банда"
    id: Mapped[int]=mapped_column(primary_key=True, autoincrement=True, nullable=False)
    Гражданское_Имя: Mapped[str]=mapped_column(String(128), nullable=False)
    Творческий_Псевдоним: Mapped[str]=mapped_column(String(128), nullable=False)
    Описание_Творческой_Деятельности: Mapped[str]=mapped_column(Text, nullable=False)
    Связь_Творчества_С_Павлопосадскими_Платками: Mapped[str] = mapped_column(Text, nullable=False)
    Ссылка_На_Инстаграм: Mapped[str] = mapped_column(String(128), nullable=False)
    Ссылка_На_ВК: Mapped[str] = mapped_column(String(128), nullable=False)
    Ссылка_На_Ютуб: Mapped[str] = mapped_column(String(128), nullable=False)
    Ссылка_На_Фейсбук: Mapped[str] = mapped_column(String(128), nullable=False)
    Ссылка_На_Телеграм: Mapped[str] = mapped_column(String(128), nullable=False)
    Ссылка_На_Одноклассники: Mapped[str] = mapped_column(String(128), nullable=False)
    Ссылка_На_Яндекс_Дзен: Mapped[str] = mapped_column(String(128), nullable=False)
    Ссылка_На_Сайт: Mapped[str] = mapped_column(String(128), nullable=False)
    Адрес_Деятельности: Mapped[str] = mapped_column(String(128), nullable=False)
    # '''CREATE table Платочная_Банда (id BIGINT NOT NULL PRIMARY KEY, Гражданское_Имя VARCHAR(128) NOT NULL,
    # Творческий_Псевдоним VARCHAR(128) NOT NULL, Описание_Творческой_Деятельности TEXT NOT NULL,
    # Связь_Творчества_С_Павлопосадскими_Платками TEXT NOT NULL, Ссылка_На_Инстаграм VARCHAR(128) NOT NULL,
    # Ссылка_На_ВК VARCHAR(128) NOT NULL, Ссылка_На_Ютуб VARCHAR(128) NOT NULL, Ссылка_На_Фейсбук VARCHAR(128) NOT NULL,
    # Ссылка_На_Телеграм VARCHAR(128) NOT NULL, Ссылка_На_Одноклассники VARCHAR(128) NOT NULL,
    # Ссылка_На_Яндекс_Дзен VARCHAR(128) NOT NULL, Ссылка_на_сайт VARCHAR(128) NOT NULL,
    # Адрес_Деятельности VARCHAR(128) NOT NULL)'''
class Platok_Schema(BaseModel):
    id: int
    Название_Платка: str = Field(min_length=5, max_length=50)
    Автор_Платка: str = Field(min_length=5, max_length=50)
    Колорит_1: str= Field(min_length=3, max_length=50)
    Колорит_2: str= Field(min_length=3, max_length=50)
    Колорит_3: str= Field(min_length=3, max_length=50)
    Колорит_4: str= Field(min_length=3, max_length=50)
    Колорит_5: str= Field(min_length=3, max_length=50)
    Узор_Темени: str= Field(min_length=3, max_length=50)
    Узор_Сердцевины: str= Field(min_length=3, max_length=50)
    Узор_Сторон: str= Field(min_length=3, max_length=50)
    Узор_Углов: str= Field(min_length=3, max_length=50)
    Узор_Края: str= Field(min_length=3, max_length=50)
    Цветы_Орнамент: str= Field(min_length=3, max_length=50)
    Изображённый_Цветок_1: str= Field(min_length=3, max_length=50)
    Изображённый_Цветок_2: str= Field(min_length=3, max_length=50)
    Изображённый_Цветок_3: str= Field(min_length=3, max_length=50)
    Изображённый_Цветок_4: str= Field(min_length=3, max_length=50)
    Изображённый_Цветок_5: str= Field(min_length=3, max_length=50)
    Размер_Платка: str= Field(min_length=3, max_length=50)
    Материал_Платка: str= Field(min_length=3, max_length=50)
    Материал_Бахромы: str= Field(min_length=3, max_length=50)
class Symbol_Schema(BaseModel):
    id: int
    Название_Символа: str = Field(min_length=3, max_length=32)
    Значение_Символа: str = Field(min_length=5, max_length=1000)
    Встречается_На_Платках: str = Field(min_length=5, max_length=200)
    Ассоциативная_Иллюстрация_1: str = Field(min_length=83, max_length=85)
    Ассоциативная_Иллюстрация_2: str= Field(min_length=83, max_length=85)
    Символ_На_Платке_1: str= Field(min_length=83, max_length=85)
    Символ_На_Платке_2: str = Field(min_length=83, max_length=85)
    Символ_На_Платке_3: str = Field(min_length=83, max_length=85)
    Символ_На_Платке_4: str = Field(min_length=83, max_length=85)
    Символ_На_Платке_5: str = Field(min_length=83, max_length=85)
class Banda_Schema(BaseModel):
    id: int
    Гражданское_Имя: str = Field(min_length=5, max_length=32)
    Творческий_Псевдоним: str = Field(min_length=5, max_length=32)
    Описание_Творческой_Деятельности: str = Field(min_length=5, max_length=2000)
    Связь_Творчества_С_Павлопосадскими_Платками: str = Field(min_length=5, max_length=2000)
    Ссылка_На_Инстаграм: str= Field(min_length=5, max_length=100)
    Ссылка_На_ВК: str= Field(min_length=5, max_length=75)
    Ссылка_На_Ютуб: str = Field(min_length=5, max_length=75)
    Ссылка_На_Телеграм: str = Field(min_length=5, max_length=75)
    Ссылка_На_Фейсбук: str = Field(min_length=5, max_length=75)
    Ссылка_На_Одноклассники: str = Field(min_length=5, max_length=75)
    Ссылка_На_Яндекс_Дзен: str = Field(min_length=5, max_length=75)
    Ссылка_На_Сайт: str = Field(min_length=5, max_length=75)
    Адрес_Деятельности: str = Field(min_length=5, max_length=75)
@app.post("/symboly", summary="Platok",tags=["Symboli"])
async def create_tradicii(symbol: Annotated[Symbol_Schema, Depends()]):
    try:
        symbol_eksemp = Symboly(id=symbol.id,Название_Символа=symbol.Название_Символа,
            Значение_Символа=symbol.Значение_Символа,
            Встречается_На_Платках=symbol.Встречается_На_Платках,
            Ассоциативная_Иллюстрация_1=symbol.Ассоциативная_Иллюстрация_1,
            Ассоциативная_Иллюстрация_2=symbol.Ассоциативная_Иллюстрация_2,
            Символ_На_Платке_1=symbol.Символ_На_Платке_1, Символ_На_Платке_2=symbol.Символ_На_Платке_2,
            Символ_На_Платке_3=symbol.Символ_На_Платке_3, Символ_На_Платке_4=symbol.Символ_На_Платке_4,
            Символ_На_Платке_5=symbol.Символ_На_Платке_5)
        #session = session_factory()
        #session.add(symbol_eksemp)
        #await session.commit()
        #await session.close()
        return symbol
        #заяц_погашен
        #try:
        #await router.broker.publish(message=f"{symbol}", queue="PLATOKY")
        #return symbol
        #except:
        #raise HTTPException(status_code=500, detail="Проблема с брокером")
    except:
        raise HTTPException(status_code=500, detail="Проблема с базой данных")

@app.get("/root", summary="root",tags=["DEBUG"])
def root():
    return {"message": "Здарова, начальник!!!"}
#ВВОД СТАРОГО ОБРАЗЦА С PYDANTIC БЕЗ ЗАВИСИМОСТЕЙ
#@app.post("/platoky_dict2", summary="Platok",tags=["Platok"])
#async def create_platok_dict(id: int,avtor_platka: str,nazvanije_platka: str,kolorit_1: str,kolorit_2: str,kolorit_3: str,
#kolorit_4: str, kolorit_5: str, uzor_temeni: str, uzor_serdceviny: str, uzor_storon: str,uzor_uglov: str,
#uzor_kraja: str, cvety_ornament: str, izobrazheniy_cvetok_1: str, izobrazheniy_cvetok_2: str, izobrazheniy_cvetok_3: str,
#izobrazheniy_cvetok_4: str, izobrazheniy_cvetok_5: str, razmer_platka: str, material_platka: str, material_bahromi: str):
#peremycka="; ;"
#soobshenije0=[]
#platok_s_api_data = {}
#platok_s_api_data["id"] = id
#soobshenije1 =  soobshenije0 + id
#platok_s_api_data["avtor_platka"] = avtor_platka
#soobshenije2 = soobshenije1 + peremycka + avtor_platka
#platok_s_api_data["nazvanije_platka"] = nazvanije_platka
#soobshenije3 = soobshenije2 + peremycka + nazvanije_platka
#platok_s_api_data["kolorit_1"] = kolorit_1
#soobshenije4 = soobshenije3 + peremycka + kolorit_1
#platok_s_api_data["kolorit_2"] = kolorit_2
#soobshenije5 = soobshenije4 + peremycka + kolorit_2
#platok_s_api_data["kolorit_3"] = kolorit_3
#soobshenije6= soobshenije5 + peremycka + kolorit_3
#platok_s_api_data["kolorit_4"] = kolorit_4
#soobshenije7 = soobshenije6 + peremycka + kolorit_4
#platok_s_api_data["kolorit_5"] = kolorit_5
#soobshenije8 = soobshenije7 + peremycka + kolorit_5
#platok_s_api_data["uzor_temeni"] = uzor_temeni
#soobhsenije9 = soobshenije8 + peremycka + uzor_temeni
#platok_s_api_data["uzor_serdceviny"] = uzor_serdceviny
#soobhsenije10=soobhsenije9 + peremycka + uzor_serdceviny
#platok_s_api_data["uzor_storon"] = uzor_storon
#soobhsenije11=soobhsenije10 + peremycka + uzor_storon
#platok_s_api_data["uzor_uglov"] = uzor_uglov
#soobshenije12=soobhsenije11 + peremycka + uzor_uglov
#platok_s_api_data["uzor_kraja"] = uzor_kraja
#soobshenije13=soobshenije12 + peremycka + uzor_kraja
#platok_s_api_data["cvety_ornament"] = cvety_ornament
#soobshenije14=soobshenije13+peremycka + cvety_ornament
#platok_s_api_data["izobrazheniy_cvetok_1"] = izobrazheniy_cvetok_1
#soobshenije15=soobshenije14 + peremycka + izobrazheniy_cvetok_1
#platok_s_api_data["izobrazheniy_cvetok_2"] = izobrazheniy_cvetok_2
#soobshenije16 = soobshenije15 + peremycka + izobrazheniy_cvetok_2
#platok_s_api_data["izobrazheniy_cvetok_3"] = izobrazheniy_cvetok_3
#soobshenije17 = soobshenije16 + peremycka + izobrazheniy_cvetok_3
#platok_s_api_data["izobrazheniy_cvetok_4"] = izobrazheniy_cvetok_4
#soobshenije18 = soobshenije17 + peremycka + izobrazheniy_cvetok_4
#platok_s_api_data["izobrazheniy_cvetok_5"] = izobrazheniy_cvetok_5
#soobshenije19 = soobshenije18 + peremycka + izobrazheniy_cvetok_5
#platok_s_api_data["razmer_platka"] = razmer_platka
#soobshenije20= soobshenije19 + peremycka + razmer_platka
#platok_s_api_data["material_platka"] = material_platka
#soobshenije21=soobshenije20 + peremycka + material_platka
#platok_s_api_data["material_bahromi"] = material_bahromi
#soobshenije22=soobshenije21 + peremycka + material_bahromi
#try:
#platok_kontroll = Platok_Schema(**platok_s_api_data)
#except:
#raise HTTPException(status_code=422, detail="Данные не прошли валидацию")
#try:
#platoch_eksemp = Platoky(id=platok_kontroll.id,Название=platok_kontroll.nazvanije_platka,
#Автор=platok_kontroll.avtor_platka, Колорит_1=platok_kontroll.kolorit_1, Колорит_2=platok_kontroll.kolorit_2,
#Колорит_3=platok_kontroll.kolorit_3, Колорит_4=platok_kontroll.kolorit_4, Колорит_5=platok_kontroll.kolorit_5,
#Узор_темени=platok_kontroll.uzor_temeni,
#Узор_сердцевины=platok_kontroll.uzor_serdceviny,
#Узор_сторон=platok_kontroll.uzor_storon, Узор_углов=platok_kontroll.uzor_uglov,
#Узор_края=platok_kontroll.uzor_kraja,
#Цветы_Орнамент=platok_kontroll.cvety_ornament,
#Изображенный_Цветок_1=platok_kontroll.izobrazheniy_cvetok_1,
#Изображенный_Цветок_2=platok_kontroll.izobrazheniy_cvetok_2,
#Изображенный_Цветок_3=platok_kontroll.izobrazheniy_cvetok_3,
#Изображенный_Цветок_4=platok_kontroll.izobrazheniy_cvetok_4,
#Изображенный_Цветок_5=platok_kontroll.izobrazheniy_cvetok_5,
#Размер_Платка=platok_kontroll.razmer_platka,
#Материал_Платка=platok_kontroll.material_platka,
#session.add(platoch_eksemp)
#await session.commit()
#except:
#raise HTTPException(status_code=500, detail="Проблема с базой данных")
#КРОЛИК ВЫКЛЮЧЕН
#try:
#await router.broker.publish(message=f"{platok_kontroll.nazvanije_platka}{"; ;"}{platok_kontroll.avtor_platka}{"; ;"}{platok_kontroll.kolorit_1}{"; ;"}{platok_kontroll.kolorit_2}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.avtor_platka}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.kolorit_1}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.kolorit_2}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.kolorit_3}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.kolorit_4}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.kolorit_5}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.uzor_temeni}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.uzor_serdceviny}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.uzor_storon}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.uzor_kraja}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.uzor_uglov}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.cvety_ornament}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.izobrazheniy_cvetok_1}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.izobrazheniy_cvetok_2}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.izobrazheniy_cvetok_3}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.izobrazheniy_cvetok_4}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.izobrazheniy_cvetok_5}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.razmer_platka}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.material_platka}", queue="PLATOKY")
#await router.broker.publish(message=f"{platok_kontroll.material_bahromi}", queue="PLATOKY")
#return {"message": "OK"}
#except:
#raise HTTPException(status_code=500, detail="Проблема с брокером")
#ПОЛУЧЕНИЕ ДАННЫХ ПО ПЛАТКУ
@app.get("/platok3", summary="Platok",tags=["Platok"])
async def root(Название_платка: str):
    platok_s_db_data = {}
    query1 = select(Platoky.Автор).where(Platoky.Название == Название_платка)
    session = session_factory()
    result1 = await session.execute(query1)
    avtor = result1.scalars().all()
    platok_s_db_data["Автор"] = avtor
    query2=select(Platoky.Колорит_1).where(Platoky.Название==Название_платка)
    session=session_factory()
    result2 =await session.execute(query2)
    kolorit_1=result2.scalars().all()
    platok_s_db_data["Колорит_1"] = kolorit_1
    query3=select(Platoky.Колорит_2).where(Platoky.Название==Название_платка)
    result3 = await session.execute(query3)
    kolorit_2 = result3.scalars().all()
    platok_s_db_data["Колорит_2"] = kolorit_2
    query4 = select(Platoky.Колорит_3).where(Platoky.Название == Название_платка)
    result4 = await session.execute(query4)
    kolorit_3 = result4.scalars().all()
    platok_s_db_data["Колорит_3"] = kolorit_3
    query5 = select(Platoky.Колорит_4).where(Platoky.Название == Название_платка)
    result5 = await session.execute(query5)
    kolorit_4 = result5.scalars().all()
    platok_s_db_data["Колорит_4"] = kolorit_4
    query6 = select(Platoky.Колорит_5).where(Platoky.Название == Название_платка)
    result6 = await session.execute(query6)
    kolorit_5 = result6.scalars().all()
    platok_s_db_data["Колорит_5"] = kolorit_5
    query7 = select(Platoky.Узор_темени).where(Platoky.Название == Название_платка)
    result7 = await session.execute(query7)
    uzor_temeni = result7.scalars().all()
    platok_s_db_data["Узор_Темени"] = uzor_temeni
    query8 = select(Platoky.Узор_сердцевины).where(Platoky.Название == Название_платка)
    result8 = await session.execute(query8)
    uzor_cerdcevini = result8.scalars().all()
    platok_s_db_data["Узор_Сердцевины"] = uzor_cerdcevini
    query9 = select(Platoky.Узор_края).where(Platoky.Название == Название_платка)
    result9 = await session.execute(query9)
    uzor_krajev = result9.scalars().all()
    platok_s_db_data["Узор_Края"] = uzor_krajev
    query10 = select(Platoky.Узор_сторон).where(Platoky.Название == Название_платка)
    result10 = await session.execute(query10)
    uzor_stroron = result10.scalars().all()
    platok_s_db_data["Узор_Сторон"] = uzor_stroron
    query11 = select(Platoky.Узор_углов).where(Platoky.Название == Название_платка)
    result11 = await session.execute(query11)
    uzor_uglov = result11.scalars().all()
    platok_s_db_data["Узор_Углов"] = uzor_uglov
    query12 = select(Platoky.Цветы_Орнамент).where(Platoky.Название == Название_платка)
    result12 = await session.execute(query12)
    cvety_ornament = result12.scalars().all()
    platok_s_db_data["Соотношение_цветов и орнамента"] =cvety_ornament
    query13 = select(Platoky.Изображенный_Цветок_1).where(Platoky.Название == Название_платка)
    result13 = await session.execute(query13)
    izobr_cvetok_1 = result13.scalars().all()
    platok_s_db_data["Изображенный цветок_1"] = izobr_cvetok_1
    query14 = select(Platoky.Изображенный_Цветок_2).where(Platoky.Название == Название_платка)
    result14 = await session.execute(query14)
    izobr_cvetok_2 = result14.scalars().all()
    platok_s_db_data["Изображенный цветок_2"] = izobr_cvetok_2
    query15 = select(Platoky.Изображенный_Цветок_3).where(Platoky.Название == Название_платка)
    result15 = await session.execute(query15)
    izobr_cvetok_3 = result15.scalars().all()
    platok_s_db_data["Изображенный цветок_3"] = izobr_cvetok_3
    query16 = select(Platoky.Изображенный_Цветок_4).where(Platoky.Название == Название_платка)
    result16 = await session.execute(query16)
    izobr_cvetok_4 = result16.scalars().all()
    platok_s_db_data["Изображенный цветок_4"] = izobr_cvetok_4
    query17 = select(Platoky.Изображенный_Цветок_5).where(Platoky.Название == Название_платка)
    result17 = await session.execute(query17)
    izobr_cvetok_5 = result17.scalars().all()
    platok_s_db_data["Изображенный цветок_5"] = izobr_cvetok_5
    query18 = select(Platoky.Размер_Платка).where(Platoky.Название == Название_платка)
    result18 = await session.execute(query18)
    razmer_platka = result18.scalars().all()
    platok_s_db_data["Размер_Платка"] = razmer_platka
    query19 = select(Platoky.Материал_Платка).where(Platoky.Название == Название_платка)
    result19 = await session.execute(query19 )
    material_platka = result19.scalars().all()
    platok_s_db_data["Материал_Платка"] = material_platka
    query20 = select(Platoky.Материал_Бахромы).where(Platoky.Название == Название_платка)
    result20 = await session.execute(query20)
    material_bahromi = result20.scalars().all()
    platok_s_db_data["Материал_Бахромы"] = material_bahromi
    return platok_s_db_data
#ВВОД СТАРОГО ОБРАЗЦА БЕЗ КОНТРАКТА С PYDANTIC И БЕЗ ЗАВИСИМОСТЕЙ
#@app.post("/platoky_dict", summary="Platok",tags=["Platok"])
#async def create_platok_dict2(id: int,avtor_platka: str,nazvanije_platka: str,kolorit_1: str,kolorit_2: str,kolorit_3: str,
#kolorit_4: str, kolorit_5: str, uzor_temeni: str, uzor_serdceviny: str, uzor_storon: str,uzor_uglov: str,
#uzor_kraja: str, cvety_ornament: str, izobrazheniy_cvetok_1: str, izobrazheniy_cvetok_2: str, izobrazheniy_cvetok_3: str,
#izobrazheniy_cvetok_4: str, izobrazheniy_cvetok_5: str, razmer_platka: str, material_platka: str, material_bahromi: str):
#peremycka = "; ;"
#platok_s_api_data = {}
#platok_s_api_data["id"] = id
#soobshenije1 = str(id)
#platok_s_api_data["avtor_platka"] = avtor_platka
#soobshenije2 = soobshenije1 + peremycka + avtor_platka
#platok_s_api_data["nazvanije_platka"] = nazvanije_platka
#soobshenije3 = soobshenije2 + peremycka + nazvanije_platka
#platok_s_api_data["kolorit_1"] = kolorit_1
#soobshenije4 = soobshenije3 + peremycka + kolorit_1
#platok_s_api_data["kolorit_2"] = kolorit_2
#soobshenije5 = soobshenije4 + peremycka + kolorit_2
#platok_s_api_data["kolorit_3"] = kolorit_3
#soobshenije6 = soobshenije5 + peremycka + kolorit_3
#platok_s_api_data["kolorit_4"] = kolorit_4
#soobshenije7 = soobshenije6 + peremycka + kolorit_4
#platok_s_api_data["kolorit_5"] = kolorit_5
#soobshenije8 = soobshenije7 + peremycka + kolorit_5
#platok_s_api_data["uzor_temeni"] = uzor_temeni
#soobhsenije9 = soobshenije8 + peremycka + uzor_temeni
#platok_s_api_data["uzor_serdceviny"] = uzor_serdceviny
#soobhsenije10 = soobhsenije9 + peremycka + uzor_serdceviny
#platok_s_api_data["uzor_storon"] = uzor_storon
#soobhsenije11 = soobhsenije10 + peremycka + uzor_storon
#platok_s_api_data["uzor_uglov"] = uzor_uglov
#soobshenije12 = soobhsenije11 + peremycka + uzor_uglov
#platok_s_api_data["uzor_kraja"] = uzor_kraja
#soobshenije13 = soobshenije12 + peremycka + uzor_kraja
#platok_s_api_data["cvety_ornament"] = cvety_ornament
#soobshenije14 = soobshenije13 + peremycka + cvety_ornament
#platok_s_api_data["izobrazheniy_cvetok_1"] = izobrazheniy_cvetok_1
#soobshenije15 = soobshenije14 + peremycka + izobrazheniy_cvetok_1
#platok_s_api_data["izobrazheniy_cvetok_2"] = izobrazheniy_cvetok_2
#soobshenije16 = soobshenije15 + peremycka + izobrazheniy_cvetok_2
#platok_s_api_data["izobrazheniy_cvetok_3"] = izobrazheniy_cvetok_3
#soobshenije17 = soobshenije16 + peremycka + izobrazheniy_cvetok_3
#platok_s_api_data["izobrazheniy_cvetok_4"] = izobrazheniy_cvetok_4
#soobshenije18 = soobshenije17 + peremycka + izobrazheniy_cvetok_4
#platok_s_api_data["izobrazheniy_cvetok_5"] = izobrazheniy_cvetok_5
#soobshenije19 = soobshenije18 + peremycka + izobrazheniy_cvetok_5
#platok_s_api_data["razmer_platka"] = razmer_platka
#soobshenije20 = soobshenije19 + peremycka + razmer_platka
#platok_s_api_data["material_platka"] = material_platka
#soobshenije21 = soobshenije20 + peremycka + material_platka
#platok_s_api_data["material_bahromi"] = material_bahromi
#soobshenije22 = soobshenije21 + peremycka + material_bahromi
#try:
#platok_kontroll = Platok_Schema(**platok_s_api_data)
#except:
#raise HTTPException(status_code=422, detail="Данные не прошли валидацию")
#ЗАЯЦ ВЫКЛЮЧЕН
#try:
#await router.broker.publish(message=f"{soobshenije22}", queue="PLATOKY")
#return {"платок в публикацию": platok_kontroll}
#except:
#raise HTTPException(status_code=500, detail="Проблема с брокером")
#ВВОД ДАННЫХ ПЛАТКА
@app.post("/platoky_vvod", summary="Platok",tags=["Platok"])
async def insert_platky(platok: Annotated[Platok_Schema,Depends()]):
#session=session_factory()
#query=select(Platoky).where(Platoky.Название==platok.Название_Платка)
#result=await session.execute(query)
#unikalnost_platka=result.scalar_one_or_none()
#if unikalnost_platka is None:
        #заяц выключен
        #await router.broker.publish(message="Это уникальный платок", queue="PLATOKY")
        #session = session_factory()
        #query2 = select(Platoky).where(Platoky.id == platok.id)
        #result2 = await session.execute(query2)
        #unikalnost_id = result2.scalar_one_or_none()
        #if unikalnost_id is None:
            try:
                platoch_eksemp = Platoky(id=platok.id, Название=platok.Название_Платка,
                Автор=platok.Автор_Платка, Колорит_1=platok.Колорит_1, Колорит_2=platok.Колорит_2, Колорит_3=platok.Колорит_3,
                Колорит_4=platok.Колорит_4, Колорит_5=platok.Колорит_5, Узор_темени=platok.Узор_Темени,
                Узор_сердцевины=platok.Узор_Сердцевины, Узор_сторон=platok.Узор_Сторон, Узор_углов=platok.Узор_Углов,
                Узор_края=platok.Узор_Края, Цветы_Орнамент=platok.Цветы_Орнамент, Изображенный_Цветок_1=platok.Изображённый_Цветок_1,
                Изображенный_Цветок_2=platok.Изображённый_Цветок_2, Изображенный_Цветок_3=platok.Изображённый_Цветок_3,
                Изображенный_Цветок_4=platok.Изображённый_Цветок_4, Изображенный_Цветок_5=platok.Изображённый_Цветок_5,
                Размер_Платка=platok.Размер_Платка, Материал_Платка=platok.Материал_Платка, Материал_Бахромы=platok.Материал_Бахромы)
                #session = session_factory()
                #session.add(platoch_eksemp)
                # await session.commit()
            except:
                raise HTTPException(status_code=500, detail="Проблема с базой данных")
            #заяц выключен
            #try:
            # router.broker.publish(message="Добавлен новый платок", queue="PLATOKY")
            #await router.broker.publish(message=f"{platok}", queue="PLATOKY")
            #return {"message": "OK"}
            #except:
            #raise HTTPException(status_code=500, detail="Проблема с брокером")
#else:
#raise HTTPException(status_code=422, detail="Данные не прошли валидацию")
            #else:
        # заяц выключен
        #await router.broker.publish(message="Такой уже есть, отмена регистрации", queue="PLATOKY")
        #raise HTTPException(status_code=422, detail="Данные не прошли валидацию")
@app.post("/banda", summary="Platok",tags=["Платочная_Банда"])
async def insert_persona(platoch_persona: Annotated[Banda_Schema,Depends()]):
    try:
        banda_eksemp = Banda(id=platoch_persona.id, Гражданское_Имя=platoch_persona.Гражданское_Имя,
        Творческий_Псевдоним=platoch_persona.Творческий_Псевдоним,
        Описание_Творческой_Деятельности=platoch_persona.Описание_Творческой_Деятельности,
        Связь_Творчества_С_Павлопосадскими_Платками=platoch_persona.Связь_Творчества_С_Павлопосадскими_Платками,
        Ссылка_На_Инстаграм=platoch_persona.Ссылка_На_Инстаграм, Ссылка_На_ВК=platoch_persona.Ссылка_На_ВК,
        Ссылка_На_Ютуб=platoch_persona.Ссылка_На_Ютуб, Ссылка_На_Фейсбук=platoch_persona.Ссылка_На_Фейсбук,
        Ссылка_На_Телеграм=platoch_persona.Ссылка_На_Телеграм,
        Ссылка_На_Одноклассники=platoch_persona.Ссылка_На_Одноклассники,
        Ссылка_На_Яндекс_Дзен=platoch_persona.Ссылка_На_Яндекс_Дзен, Ссылка_На_Сайт=platoch_persona.Ссылка_На_Сайт,
        Адрес_Деятельности=platoch_persona.Адрес_Деятельности)
        #session = session_factory()
        #session.add(banda_eksemp)
        #await session.commit()
        #await session.close()
        return platoch_persona
        #заяц выключен
        #try:
        #await router.broker.publish(message="Добавлен новый персонаж", queue="PLATOKY")
        #await router.broker.publish(message=f"{platoch_persona}", queue="PLATOKY")
        #return {"message": "OK"}
        #except:
        #raise HTTPException(status_code=500, detail="Проблема с брокером")
    except:
        raise HTTPException(status_code=500, detail="Проблема с базой данных")
#async def create_platky():
#async with engine.begin() as connection:
#await connection.run_sync(Base.metadata.create_all)
#async def destroy_platky():
#async with engine.begin() as connection:
#await connection.run_sync(Base.metadata.drop_all())
async def kostily_BD():
    # создать ДБ
    import psycopg2 as ps
    from psycopg2.errors import DuplicateDatabase as Oshibka
    from psycopg2 import sql
    connection = None
    try:
        print('~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~')
        print(Back.GREEN + Fore.BLACK + Style.BRIGHT + 'Создать базу Данных')
        databasename = os.getenv('DATABASENAME')
        connection = ps.connect(host="localhost", database="postgres", user="postgres", password=os.getenv("DBPASSWORD"),
                                port="5432")
        connection.autocommit = True
        cursor = connection.cursor()
        cursor.execute(sql.SQL("CREATE DATABASE {}").format(sql.Identifier(databasename)))
        cursor.close()
        print(Back.LIGHTGREEN_EX + Fore.BLACK + Style.BRIGHT + 'БД успешно создана, моя Госпожа')
        print('~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~')
    except Oshibka:
        print('Такая БД уже есть, моя Госпожа!!!')
        print('~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~')
    finally:
        if connection:
            connection.close()
        if cursor:
            cursor.close()
async def create_platky():
    async with engine.begin() as connection:
        await connection.run_sync(Base.metadata.create_all)
async def main():
    init(autoreset=True)
    #await kostily_BD()
    await create_platky()
    uvicorn.run("prilozhenije:app", reload=True, port=8000)
#ЗАЯЦ ВЫКЛЮЧЕН
#app.include_router(router)
if __name__ == "__main__":
    asyncio.run(main())
